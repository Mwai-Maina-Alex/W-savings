<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wonder Savings — Login</title>
  <link rel="stylesheet" href="css/style.css"> <!-- keep your existing CSS here -->
  <style>
    /* small page-specific tweaks so it's readable even without your CSS */
    .page { max-width:700px;margin:40px auto;padding:18px;background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.04) }
    h1{margin:0 0 8px}
    .muted{color:#666;font-size:14px;margin-bottom:12px}
    input,button{display:block;width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ddd}
    .actions{display:flex;gap:8px}
    .actions a{display:inline-block;padding:10px 12px;text-decoration:none;color:#2b6cb0}
    #login-feedback{color:#b91c1c;margin-top:6px}
  </style>
</head>
<body>
  <div class="page">
    <h1>Wonder Savings</h1>
    <div class="muted">Login to continue</div>

    <form onsubmit="handleLogin(event)">
      <input id="login-username" placeholder="Username or email" autocomplete="username" />
      <input id="login-password" type="password" placeholder="Password" autocomplete="current-password" />
      <button type="submit">Log in</button>
    </form>

    <div id="login-feedback"></div>

    <p style="margin-top:12px;">Don't have an account? <a href="signup.html">Sign up</a></p>
    <p style="margin-top:6px;"><a href="#" onclick="clearDemo()">Clear demo data (local only)</a></p>
    <footer style="margin-top:14px;font-size:13px;color:#777">&copy; 2025 Wonder Savings</footer>
  </div>

  <script>
    // ====== small localStorage helpers (same model used by all pages) ======
    const LS_USERS_KEY = 'ws_users';
    const LS_CURR_KEY  = 'ws_currentUser';

    function loadUsers(){ return JSON.parse(localStorage.getItem(LS_USERS_KEY) || '[]'); }
    function saveUsers(u){ localStorage.setItem(LS_USERS_KEY, JSON.stringify(u)); }
    function setCurrentUser(un){ if(!un) localStorage.removeItem(LS_CURR_KEY); else localStorage.setItem(LS_CURR_KEY, un); }
    function getCurrentUser(){ return localStorage.getItem(LS_CURR_KEY); }
    function findUserByIdentifier(id){ if(!id) return null; id = id.trim().toLowerCase(); return loadUsers().find(u => u.username === id || (u.email && u.email === id)) || null; }

    // Redirect to dashboard if already logged in
    document.addEventListener('DOMContentLoaded', () => {
      if (getCurrentUser()) {
        // already logged in
        window.location.href = 'dashboard.html';
      }
    });

    // ====== handle login ======
    function handleLogin(e){
      e && e.preventDefault();
      const who = (document.getElementById('login-username').value || '').trim();
      const pw  = (document.getElementById('login-password').value || '');
      const fb  = document.getElementById('login-feedback');
      fb.textContent = '';

      if(!who || !pw){ fb.textContent = 'Please enter username/email and password.'; return; }

      const user = findUserByIdentifier(who.toLowerCase());
      if(!user || user.password !== pw){ fb.textContent = 'Invalid credentials.'; return; }

      setCurrentUser(user.username);
      fb.style.color = '#0f766e';
      fb.textContent = 'Login successful — redirecting...';
      setTimeout(()=> window.location.href = 'dashboard.html', 450);
    }

    // developer helper to clear demo data
    function clearDemo(){
      if(confirm('Clear all demo data stored in this browser?')) {
        localStorage.removeItem(LS_USERS_KEY);
        localStorage.removeItem(LS_CURR_KEY);
        alert('Demo data cleared.');
      }
    }
  </script>
</body>
</html>
